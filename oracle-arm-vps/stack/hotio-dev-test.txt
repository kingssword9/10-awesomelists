######################################################################################
######################################################################################
#DOCKER STACK START#
#v:1.0
##

---
version: "3"
#volumes:
# web_data:

services:
  ##################test ENV######################################
  # x-storagepath: &storagepath
  #     volumes:
  #       - /etc/localtime:/etc/localtime:ro
  #       - /media/plexmedia:/storage

  # *storagepath # for using

  #########################
  #setup dozzle logviewer https://hub.docker.com/r/amir20/dozzle/
  #swag
  #organizer and request services. heimdall? dashboards
  #jackett?

  ##########################################################
  ###############################GLUETUN VPN FOR NETWORK WIDE VPN#########################################################
  gluetun:
    image: qmcgaw/gluetun:v3.32.0
    container_name: gluetun-vpn
    cap_add:
      - NET_ADMIN
    networks:
      - arr-network # does vpn magic on this network?
    ports:
      - 8888:8888/tcp # HTTP proxy
      - 8388:8388/tcp # Shadowsocks
      - 8388:8388/udp # Shadowsocks
      #- 8000:8000/tcp # dont use http control server https://github.com/qdm12/gluetun/wiki/HTTP-control-server
      ######SERVICES-OTHER-CONTAINERS############################
      - 8080:8080 #sabnzbd
    volumes:
      - /media/localconfig/gluetun:/gluetun
    environment:
      #user in container
      - PUID=1000
      - PGID=1000
      - UMASK=002 #others/everyone cant write

      # See https://github.com/qdm12/gluetun/wiki
      #required
      - VPNSP=surfshark
      #- VPN_TYPE=openvpn
      - OPENVPN_USER=6rEVKMUuwWwbKBmAL6Ea7wvr
      - OPENVPN_PASSWORD=afy6LGV9mdn6Ze5vpb46Mumg
      # Timezone for accurate log times
      - TZ=Europe/Amsterdam
      ########################

      #optional
      - REGION=Europe #regions https://github.com/qdm12/gluetun/wiki/Surfshark#Servers # for mulihop
      - SERVER_HOSTNAME=be-bru.prod.surfshark.com #optional
      - UPDATE_PERIOD=24h #default 24h updates ips vor VPN servers (or update image for latest)
    #  - FIREWALL_OUTBOUND_SUBNETS=192.168.2.0/24,172.23.0.0/16 #access to my lan devices from containers?
    #  - VERSION_INFORMATION=on # updates server info vpn? logs message
    #### vpn health checks
    #   - HEALTH_ADDRESS_TO_PING=github.com
    #   - HEALTH_VPN_DURATION_INITIAL=60s
    #   - HEALTH_VPN_DURATION_ADDITION=60s

    # OpenVPN:
    #- OPENVPN_USER=
    #- OPENVPN_PASSWORD=
    # Wireguard:
    # - WIREGUARD_PRIVATE_KEY=wOEI9rqqbDwnN8/Bpp22sVz48T71vJ4fYmFWujulwUU=
    # - WIREGUARD_ADDRESS=10.64.222.21/32

    #restart: unless-stopped bug atm with restart? stop whole stack

    ###################################GLUETUN VPN#####################################################
    #####################HOTIO.DEV#########################################
    #---------------------------------------------SAB
    #https://hotio.dev/containers/sabnzbd/
  sabnzbd:
    container_name: sabnzbd
    image: hotio/sabnzbd:release
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002 #others/everyone cant write
      - TZ=Europe/Amsterdam
    volumes:
      - /media/localconfig/sabnzbd:/config
      #- /media/localconfig/sabnzbd:/config
      - /media/plexmedia:/storage
      - /localssd/sab:/ssd #ssd local to enthoo/ ds-n1
    #volumes:
    #- web_data:/config #for setting up volumes if sql doesnt get fixed
    #networks:
    #- arr-network # do not use with vpn container
    #ports:
    #- "8080:8080" # do not use with vpn container
    #ports:
    #  - 8080:8080

    network_mode: "service:gluetun" #uses vpn surfshark for internet

  
      

    #####################HOTIO.DEV#########################################
    #---------------------------------------------sonarr
    #https://hotio.dev/containers/sonarr/
  sonarr:
    container_name: sonarr
    image: hotio/sonarr:release
    ports:
      - "8989:8989"
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=Europe/Amsterdam
    volumes:
      - /media/localconfig/sonarr:/config
      - /media/plexmedia:/storage
      - /localssd/sab:/ssd #ssd local to enthoo/ ds-n1
      - /media/plexmedia/1--sortingarea/test/complete/series:/storage1 #extra test #change to non test if works

    networks:
      - arr-network

    #####################TESTING VERSION ONLY ATM#########################################
    #---------------------------------------------prowlarr
    #https://hotio.dev/containers/prowlarr/

    # prowlarr:
    #   container_name: prowlarr
    #   image: hotio/prowlarr:testing
    #   ports:
    #     - "9696:9696"
    #   environment:
    #     - PUID=1000
    #     - PGID=1000
    #     - UMASK=002
    #     - TZ=Europe/Amsterdam
    #   volumes:
    #     - /<host_folder_config>:/config

    ##########################PROWLARR##############################################################
  prowlarr:
    container_name: prowlarr
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=Europe/Amsterdam
      - PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      - HOME=/root
      - LANGUAGE=en_US.UTF-8
      - LANG=en_US.UTF-8
      - TERM=xterm
      - XDG_CONFIG_HOME=/config/xdg

    image: linuxserver/prowlarr:develop # cant use latest tag #update to latest https://fleet.linuxserver.io or use develop
    ports:
      - 9696:9696/tcp
    restart: unless-stopped
    volumes:
      - /media/localconfig/prowlarr:/config
    networks:
      - arr-network


    ##########################qbittorrentvpn##############################################################
    #OLD DELETE OR CHANGE TO OTHER IMAGE #update to hotdev version
  qbittorrentvpn:
    container_name: qbittorrentvpn
    environment:
      - ENABLE_PRIVOXY=no
      - LAN_NETWORK=192.168.2.0/24
      - NAME_SERVERS=1.1.1.1,8.8.8.8
      - PGID=1000
      - PUID=1000
      - UMASK=002
      - TZ=Europe/Amsterdam
      - VPN_CLIENT=openvpn
      - VPN_ENABLED=yes
      #- VPN_OPTIONS=
      - VPN_PASS=afy6LGV9mdn6Ze5vpb46Mumg
      - VPN_PROV=custom
      - VPN_USER=6rEVKMUuwWwbKBmAL6Ea7wvr
      - WEBUI_PORT=8050
      - PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      - HOME=/home/nobody
      - TERM=xterm
      - LANG=en_GB.UTF-8
      - CREATE_TUN_DEVICE=true ##added
    hostname: qbittorrentvpn
    image: binhex/arch-qbittorrentvpn:latest
    ports:
      - 51413:51413/tcp
      - 51413:51413/udp
      - 6881:6881/tcp
      - 6881:6881/udp
      - 8050:8050/tcp
      - 8290:8118/tcp
    privileged: true
    restart: unless-stopped
    security_opt:
      - label=disable
    volumes:
      - /media/localconfig/qbittorrentvpn/data:/data
      - /etc/localtime:/etc/localtime:ro #does it need this??? with utc above
      - /media/plexmedia:/storage
      - /media/localconfig/qbittorrentvpn:/config
      - /media/localconfig/.openvpn:/config/openvpn
      - /media/localconfig/.wireguard:/config/wireguard
      - /media/localconfig/qbittorrentvpn/qBittorrent/config/vuetorrent:/vuetorrent #loads alt webui vuetorrent
    networks:
      - arr-network
    devices:
      - /dev/net/tun
    cap_add:
      - NET_ADMIN

    ##########################bazarr##############################################################
    #HOTIO updated version
  bazarr:
    container_name: bazarr
    image: hotio/bazarr
    ports:
      - 6767:6767
    environment:
      - PUID=1000
      - PGID=1000
      - UMASK=002
      - TZ=Europe/Amsterdam
    volumes:
      - /media/localconfig/bazarr-hotio/config:/config
      - /media/plexmedia:/storage # hardlinks would be possible with this. requires settings in bazarr | remove links below then
      - /media/plexmedia/movies:/movies #optional
      - /media/plexmedia/series:/tv #optional
      - /media/plexmedia/anime:/anime #optional
    restart: unless-stopped
    networks:
      - arr-network
    ##########################bazarr##############################################################

    #not updated yet to hotio
  radarr:
    container_name: radarr
    environment:
      - PGID=1000
      - PUID=1000
      - TZ=Europe/Amsterdam
      - UMASK=002
      - PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin
      - HOME=/root
      - LANGUAGE=en_US.UTF-8
      - LANG=en_US.UTF-8
      - TERM=xterm
      - XDG_CONFIG_HOME=/config/xdg
    image: ghcr.io/linuxserver/radarr:latest
    ports:
      - 7878:7878/tcp
    restart: unless-stopped
    volumes:
      - /media/localconfig/radarr:/config
      - /etc/localtime:/etc/localtime:ro
      - /media/plexmedia:/storage
    networks:
      - arr-network

    ##########################watchtower##############################################################
  watchtower:
    image: containrrr/watchtower
    container_name: watchtower-updater
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock

#######network mapping external###########
networks:
  arr-network:
    external: true #true means that this network has been created externally before starting this stack

#END OF FILE#
######################################################################################
######################################################################################
######################################################################################
